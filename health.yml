app-connectivity:
  get:
    summary: Get App Connectivity report.
    description: >-
      Get a list of all unhealthy apps reported by gateways.
      Requires a license.
    tags:
      - Health
    parameters:
      - $ref: './common.yml#/parameters/query'
      - $ref: './common.yml#/parameters/range'
      - $ref: './common.yml#/parameters/orderBy'
      - $ref: './common.yml#/parameters/descending'
      - $ref: './common.yml#/parameters/filterBy'
    responses:
      '200':
        description: List of unhealthy apps.
        content:
          application/json:
            schema:
              $ref: '#/definitions/UnhealthyAppList'
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'

definitions:
  UnhealthyAppList:
    allOf:
      - $ref: './common.yml#/definitions/ResultList'
      - type: object
        description: >- 
          Represents a list of unhealthy apps.
          On version 6.5, the response format of this API has changed to have one entry per Site instead of Gateway.
          In order to use the old format please send the Accept header with version 21.
        properties:
          data:
            type: array
            description: List of unhealthy apps.
            items:
              $ref: '#/definitions/UnhealthyApp'
  UnhealthyApp:
    type: object
    description: Represents an unhealthy app on a Site. Same app could appear multiple times if it is used by multiple Sites using the Override Site feature.
    properties:
      entitlement:
        type: string
        format: uuid
        description: ID of the Entitlement.
        example: 4c07bc67-57ea-42dd-b702-c2d6c45419fc
      entitlementName:
        type: string
        description: Name of the Entitlement.
      reportCount:
        type: integer
        description: Total report count for the Entitlement.
      userCount:
        type: integer
        description: Total user count affected by the unhealthy app.
      site:
        type: string
        format: uuid
        description: ID of the Site.
        example: 4c07bc67-57ea-42dd-b702-c2d6c45419fc
      siteName:
        type: string
        description: Name of the Site.
      gatewaysReportingCount:
        type: integer
        description: The total amount of Gateways reporting this Entitlement as unhealthy.
      gatewayCountInSite:
        type: integer
        description: The total amount of active Gateways in the Site.
      lastReported:
        type: string
        format: date-time
        description: Timestamp of the last time the Entitlement was reported unhealthy.
      appErrors:
        type: array
        description: Specific apps being reported unhealthy and its details.
        items:
          type: object
          properties:
            ip:
              type: string
              description: IP of the resource.
              example: 10.0.0.52
            index:
              type: integer
              description: Action index of the Entitlement.
            reportCount:
              type: integer
              description: Report count of the unhealthy app.
            userCount:
              type: integer
              description: User count of the unhealthy app.
            portRange:
              type: string
              description: Port range affected on the unhealthy app.
              example: 1-4000
            reason:
              type: string
              description: The reason for the unhealth.
              example: rst-received
            appliance:
              type: string
              format: uuid
              description: ID of the reporting Gateway Appliance.
              example: 4c07bc67-57ea-42dd-b702-c2d6c45419fc
            gatewayName:
              type: string
              description: Name of the Gateway Appliance.
            lastReported:
              type: string
              format: date-time
              description: Timestamp of the last time the app was reported unhealthy.
      hasNameError:
        type: boolean
        description: Whether this Entitlement has a name error or not.
      nameErrors:
        type: array
        description: Name errors reported for this Entitlement.
        items:
          type: object
          properties:
            host:
              type: string
              description: Action host that has the error.
              example: invalid.hostname.com
            errors:
              type: array
              description: List of error messages for the name.
              items:
                type: string
            userCount:
              type: integer
              description: User count for the unhealthy name.
            appliance:
              type: string
              format: uuid
              description: ID of the reporting Gateway Appliance.
              example: 4c07bc67-57ea-42dd-b702-c2d6c45419fc
            gatewayName:
              type: string
              description: Name of the Gateway Appliance.
            lastReported:
              type: string
              format: date-time
              description: Timestamp of the last time the name was reported unhealthy.
