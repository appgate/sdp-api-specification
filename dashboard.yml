admin-messages:
  get:
    summary: Get the Admin Messages.
    description: >-
      Get a list of all Admin Messages generated by the system.
      It includes duplicate messages generated over time.
      Use "/summarize" to get distinct messages like the Admin UI.
    tags:
      - Admin Messages
    parameters:
      - $ref: './common.yml#/parameters/authorization'
    responses:
      '200':
        description: List of Admin Messages.
        content:
          application/json:
            schema:
              $ref: '#/definitions/AdminMessagesList'
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
  delete:
    summary: Delete Admin Messages.
    description: >-
      Deletes all Admin Messages by default. If **both** `message` and `source` 
      query parameters are present, deletes only messages matching these parameters.
    tags:
      - Admin Messages
    parameters:
      - $ref: './common.yml#/parameters/authorization'
      - name: message
        in: query
        description: The message text of an Admin Message.
        schema:
          type: string
      - name: source
        deprecated: true
        in: query
        description: Source of the Admin Message.
        schema:
          type: string
    responses:
      '204':
        description: Admin messages were deleted successfully.
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'

admin-messages-metadata:
    put:
      summary: Update Admin Message Metadata.
      description: Update the metadata of an Admin Message.
      tags:
        - Admin Messages
      parameters:
        - $ref: './common.yml#/parameters/authorization'
        - name: id
          in: path
          description: The UUID of the Admin Message Metadata.
          schema:
            type: string
            example: 4c07bc67-57ea-42dd-b702-c2d6c45419fc

      responses:
        '200':
          description: The updated Admin Message Metadata.
          content:
            application/json:
              schema:
                $ref: '#/definitions/AdminMessageMetadata'
        '401':
          $ref: './common.yml#/responses/TokenError'
        '403':
          $ref: './common.yml#/responses/PermissionError'
        '406':
          $ref: './common.yml#/responses/NotAcceptableError'
        '500':
          $ref: './common.yml#/responses/UnexpectedError'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/definitions/AdminMessageMetadata'

admin-messages-summarize:
  get:
    summary: Get a summary of Admin Messages.
    description: >-
      List all summarized Admin Messages generated by the system.
      This API call is recommended as some of the Admin Messages may be duplicated too much in case of a configuration
      problem on a heavy loaded system.
    tags:
      - Admin Messages
    parameters:
      - $ref: './common.yml#/parameters/authorization'
    responses:
      '200':
        description: Summary of Admin Messages.
        content:
          application/json:
            schema:
              $ref: '#/definitions/AdminMessagesSummarize'

      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'

stats-appliances:
  get:
    deprecated: true
    summary: Get Appliance Stats.
    description: >-
      Get Stats and status of the active appliances.
      This API makes the controller to query every active appliance for status.
      The operation may take long if one or more appliances take long to respond.


      **Note:** if identical filter keys are chained with '&', the first filter is applied
      and the rest are ignored.


      Deprecated as of 6.3. Use `/appliances/status` instead.
    tags:
      - Appliance Stats (deprecated)
    parameters:
      - $ref: './common.yml#/parameters/authorization'
      - $ref: './common.yml#/parameters/query'
      - $ref: './common.yml#/parameters/range'
      - $ref: './common.yml#/parameters/orderBy'
      - $ref: './common.yml#/parameters/descending'
      - $ref: './common.yml#/parameters/filterBy'
    responses:
      '200':
        description: Active Appliances stats.
        content:
          application/json:
            schema:
              $ref: '#/definitions/StatsAppliancesList'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'

app-discovery:
  get:
    summary: Get Discovered Apps.
    description: >-
      Deprecated as of 6.4. Functionality will be replaced with another feature.
      Get Discovered Apps for the last 7 days. Rebooting a Gateway resets the Discovered Apps for that Gateway.
      This API makes the Controller to query every Gateway in the system to collect the statistics.
      The operation may take long if one or more appliances take long to respond.
    deprecated: true
    tags:
      - Discovered Apps (deprecated)
    parameters:
      - $ref: './common.yml#/parameters/authorization'
      - $ref: './common.yml#/parameters/query'
      - $ref: './common.yml#/parameters/range'
      - $ref: './common.yml#/parameters/orderBy'
      - $ref: './common.yml#/parameters/descending'
    responses:
      '200':
        description: Discovered Apps.
        content:
          application/json:
            schema:
              $ref: '#/definitions/AppDiscovery'

      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'

top-entitlements:
  get:
    summary: Get Top Entitlements.
    description: >-
      Get the (most used) Top Entitlements for the last 24 hours.
      Each Gateway keeps track of the most used 20 Entitlements and they are aggregated on the Controller.
      Number of  Entitlements in this stats varies accordingly.
      Rebooting a Gateway resets the most used Entitlements for that Gateway.
      This API makes the Controller to query every Gateway in the system to collect the statistics.
      The operation may take long if one or more Gateways take long to respond.
    tags:
      - Top Entitlements
    parameters:
      - $ref: './common.yml#/parameters/authorization'
      - $ref: './common.yml#/parameters/range'
      - $ref: './common.yml#/parameters/orderBy'
      - $ref: './common.yml#/parameters/descending'
    responses:
      '200':
        description: Top Entitlements.
        content:
          application/json:
            schema:
              $ref: '#/definitions/TopEntitlements'

      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'

active-sessions:
  get:
    summary: Get Active Client Sessions.
    deprecated: true
    description: >-
      Deprecated as of 6.3.0. Please use /active-sessions-dn API.
      Get currently Active Client Sessions.
      This API makes the Controller to query every Gateway in the system to collect the session data.
      The operation may take long if one or more Gateways take long to respond.
    tags:
      - Active Sessions
    parameters:
      - $ref: './common.yml#/parameters/authorization'
      - $ref: './common.yml#/parameters/query'
      - $ref: './common.yml#/parameters/range'
      - $ref: './common.yml#/parameters/orderBy'
      - $ref: './common.yml#/parameters/descending'
      - $ref: '#/parameters/geolocationQuery'
      - $ref: './common.yml#/parameters/filterBy'
    responses:
      '200':
        description: >-
          Active Client Sessions per Gateway.
          Note that the Appgate SDP Admin UI aggregates this data to list device&users.
          Disconnected Clients disappear after 5 minutes.
          When a Client fails over to another Gateway, the API may return the Client on multiple Gateways until during
          this period.
        content:
          application/json:
            schema:
              $ref: '#/definitions/ActiveSessions'

      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
active-sessions-dn:
  get:
    summary: Get Active Client Sessions grouped by Distinguished Names.
    description: >-
      Get session data from currently Active Client Sessions grouped by distinguished name.
      This API makes the Controller to query every Gateway in the system to collect the session data.
      The operation may take long if one or more Gateways take long to respond.
    tags:
      - Active Sessions
    parameters:
      - $ref: './common.yml#/parameters/authorization'
      - $ref: './common.yml#/parameters/query'
      - $ref: './common.yml#/parameters/range'
      - $ref: './common.yml#/parameters/orderBy'
      - $ref: './common.yml#/parameters/descending'
      - $ref: '#/parameters/geolocationQuery'
      - $ref: './common.yml#/parameters/filterBy'
    responses:
      '200':
        description: >-
          Active Client Sessions per user.
          Disconnected Clients disappear after 5 minutes.
          When a Client fails over to another Gateway, the API may return the Client on multiple Gateways until during
          this period.
        content:
          application/json:
            schema:
              $ref: '#/definitions/ActiveSessionsDn'
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
active-sessions-dashboard:
  get:
    summary: Get Dashboard Data for Active Sessions.
    description: >-
      Retrieves dashboard data related to active sessions. This includes information about the total count of
      sessions, geolocation data, and client version support.


      **NOTE:** This endpoint is intended for internal use and may be changed or removed at any point.
    tags:
      - Active Sessions
    parameters:
      - $ref: './common.yml#/parameters/authorization'
    responses:
      '200':
        description: Dashboard data for active sessions.
        content:
          application/json:
            schema:
              $ref: '#/definitions/DashboardSessionsDto'
            examples:
              example1:
                value:
                  totalCount: 6
                  geoIpData:
                    - sessionCount: 3
                      latitude: 55.8667
                      longitude: 12.8333
                      countryCode: "SE"
                      continentCode: "EU"
                      ips: [ "192.0.2.1", "192.0.2.2" ]
                    - sessionCount: 1
                      latitude: 37.751
                      longitude: -97.822
                      countryCode: "US"
                      continentCode: "NA"
                      ips: [ "198.51.100.1" ]
                    - sessionCount: 1
                      latitude: 20.0
                      longitude: 77.0
                      countryCode: "IN"
                      continentCode: "AS"
                      ips: [ "203.0.113.1" ]
                  versions:
                    "6.0.0-release-1234":
                      supportStatus: "full"
                      sessionCount: 3
                    "5.5.0-release-1234":
                      supportStatus: "partial"
                      sessionCount: 2
                    "5.4.1-release-1234":
                      supportStatus: "none"
                      sessionCount: 1
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
session-info-distinguished-name:
  get:
    summary: Get details of a specific Active Client Session.
    description: >-
      Get the details of a specific Active Client Session from all Gateways.
      This API makes the Controller to query very Gateway in the system to collect the session data.
      The operation may take long if one or more Gateways take long to respond.
    tags:
      - Active Sessions
    parameters:
      - $ref: './common.yml#/parameters/authorization'
      - $ref: './common.yml#/parameters/distinguishedName'
    responses:
      '200':
        description: >-
          Details of an Active Client Session per Gateway.
          Disconnected Clients disappear after 5 minutes.
          When a Client fails over to another Gateway, the API may return the Client on multiple Gateways until during
          this period.
        content:
          application/json:
            schema:
              $ref: '#/definitions/SessionInfoDistinguishedName'
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '404':
        $ref: './common.yml#/responses/NotFoundError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
user-logins:
  get:
    summary: Get User Logins Per Hour.
    deprecated: true
    description: >-
      Deprecated as of 6.3.0. Please use /on-boarded-devices APIs.
      Get the User Logins Per Hour for the last 24 hours.
    tags:
      - User Logins Per Hour (deprecated)
    parameters:
      - $ref: './common.yml#/parameters/authorization'
    responses:
      '200':
        description: User Logins Per Hour.
        content:
          application/json:
            schema:
              $ref: '#/definitions/UserLogins'
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
on-boarded-devices:
  get:
    summary: Get Device On-Boardings Per Hour.
    deprecated: true
    description: >-
      Deprecated as of 6.3.0. Please use /on-boarded-devices APIs.
      Get the Device On-Boardings Per Hour for the last 24 hours.
    tags:
      - Devices On-Boarded Per Hour (deprecated)
    parameters:
      - $ref: './common.yml#/parameters/authorization'
    responses:
      '200':
        description: Device On-Boardings Per Hour.
        content:
          application/json:
            schema:
              $ref: '#/definitions/OnBoardedDevices'
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
parameters:
  geolocationQuery:
    name: geolocationQuery
    description: Query parameters for finding active sessions in a given radius in the world.
    in: query
    schema:
      $ref: '#/definitions/GeolocationQuery'
    style: form
    explode: true
    allowEmptyValue: true
    example:
      latitude: 59.408
      longitude: 17.8678
      radiusKilometers: 200
definitions:
  BaseStats:
    type: object
    properties:
      name:
        type: string
        description: User-friendly name for the stats. Deprecated as of 6.4
        example: appliances
        deprecated: true
      creationDate:
        type: string
        format: 'date-time'
        description: The time the stats was generated. Deprecated as of 6.4
        deprecated: true
      refreshInterval:
        type: number
        description: Recommended refresh interval in minutes. Deprecated as of 6.4
        example: 1
        deprecated: true
  AdminMessagesList:
    type: object
    properties:
      data:
        type: array
        items:
          type: object
          properties:
            id:
              type: string
              format: uuid
              description: Randomly generated UUID.
              example: 4c07bc67-57ea-42dd-b702-c2d6c45419fc
            level:
              type: string
              description: The severity of the message.
              enum:
                - Information
                - Warning
                - Error
                - Critical
            category:
              type: string
              description: Message category.
              enum:
                - Configuration
                - Connectivity
                - Version
            message:
              type: string
              description: The message.
              example: Identity Provider "local" does not have IP Pool assigned.
            source:
              type: string
              description: >-
                The name of the Appliance that generated this message.
              example: controller-1
            created:
              type: string
              format: date-time
              description: When the Admin Message generated.
  AdminMessagesSummarize:
    type: object
    properties:
      data:
        type: array
        items:
          type: object
          properties:
            level:
              type: string
              description: The severity of the Admin Message.
              enum:
                - Information
                - Warning
                - Error
                - Critical
            category:
              type: string
              description: Message category.
              enum:
                - Configuration
                - Connectivity
            message:
              type: string
              description: The Admin Message.
              example: Identity Provider "local" does not have IP Pool assigned.
            source:
              type: string
              deprecated: true
              description: >-
                The name of the Appliance(s) that generated this message.
              example: controller-1, controller-2
            sources:
              type: array
              items:
                type: string
              description: >-
                The name of the Appliance(s) that generated this message.
              example:
                - controller-1
                - controller-2
            created:
              type: string
              format: date-time
              description: When the Admin Message generated the last time.
            count:
              type: number
              description: Number of times this Admin Message was generated.
              example: 152
            metadata:
              $ref: '#/definitions/AdminMessageMetadata'
  AdminMessageMetadata:
    allOf:
      - type: object
        description: Additional metadata for the message.
        required:
          - message
          - status
        properties:
          id:
            type: string
            description: The uuid of the message metadata.
            example: 4c07bc67-57ea-42dd-b702-c2d6c45419fc
          message:
            type: string
            description: The message text.
            example: Identity Provider "local" does not have IP Pool assigned.
          status:
            type: string
            description: The status of the message.
            enum:
              - Unresolved
              - Resolved
              - Muted
          appliedAt:
            type: string
            format: date-time
            description: When the message metadata was updated.
            example: 2020-01-01T12:00:00Z
      - $ref: './common.yml#/definitions/AppliedBy'
  StatsAppliancesList:
    allOf:
      - $ref: '#/definitions/BaseStats'
      - $ref: './common.yml#/definitions/ResultListBase'
      - type: object
        properties:
          queries:
            type: array
            description: The queries applied to the list.
            items:
              type: string
          filterBy:
            type: array
            description: The filters applied to the list.
            items:
              $ref: './common.yml#/definitions/FilterBy'
          controllerCount:
            type: number
            description: The number of active Appliances with the Controller role enabled.
            example: 2
          gatewayCount:
            type: number
            description: The number of active Appliances with the Gateway role enabled.
            example: 12
          applianceCount:
            type: number
            description: The number of active Appliances in total.
            example: 14
          logServerCount:
            type: number
            description: The number of active Appliances with the LogServer role enabled.
            example: 1
          logForwarderCount:
            type: number
            description: The number of active Appliances with the LogForwarder role enabled.
            example: 0
          connectorCount:
            type: number
            description: The number of active Appliances with the Connector role enabled.
            example: 6
          portalCount:
            type: number
            description: The number of active Appliances with the Portal role enabled.
            example: 6
          data:
            type: array
            items:
              type: object
              description: An active Appliance status details.
              properties:
                id:
                  type: string
                  format: uuid
                  description: ID of the Appliance.
                  example: 4c07bc67-57ea-42dd-b702-c2d6c45419fc
                name:
                  type: string
                  description: Name of the Appliance.
                  example: Controller1
                siteName:
                  type: string
                  description: Name of the Site for this Appliance.
                  example: Default Site
                tags:
                  type: array
                  description: Tags of the Appliance.
                  items:
                    type: string
                  example:
                    - developer
                    - api-created
                online:
                  type: boolean
                  description: Whether the Appliance is reachable by the Controller or not. Deprecated as of 5.1. "status" field will be set to "offline" instead.
                  deprecated: true
                version:
                  type: string
                  description: The Appliance build version.
                  example: 4.2.0-12161-release
                state:
                  type: string
                  description: State of the Appliance. For internal use.
                  example: controller_ready
                volumeNumber:
                  type: number
                  description: The volume number in use.
                  example: 1
                status:
                  type: string
                  description: Aggregated status of the Appliance.
                  enum:
                    - healthy
                    - busy
                    - warning
                    - error
                    - n/a
                    - offline
                function:
                  type: string
                  description: Comma-separated list of functions enabled on this Appliance in short format.
                  example: CTR, GW, LS
                controller:
                  $ref: 'common.yml#/definitions/ControllerRole'
                logServer:
                  $ref: 'common.yml#/definitions/ApplianceRole'
                logForwarder:
                  $ref: 'common.yml#/definitions/ApplianceRole'
                gateway:
                  $ref: 'common.yml#/definitions/ApplianceWithSessionsRole'
                connector:
                  $ref: 'common.yml#/definitions/ApplianceWithSessionsRole'
                portal:
                  $ref: 'common.yml#/definitions/ApplianceWithSessionsRole'
                appliance:
                  $ref: 'common.yml#/definitions/ApplianceBaseRole'
                numberOfSessions:
                  type: integer
                  description: Number of sessions on Gateway, Portal or Connector.
                  example: 241
                cpu:
                  type: number
                  format: float
                  description: Current CPU utilization % on the Appliance.
                  example: 1.2
                memory:
                  type: number
                  format: float
                  description: Current memory reserved % on the Appliance.
                  example: 21.5
                disk:
                  type: number
                  format: float
                  description: Current disk usage % on the Appliance.
                  example: 1.2
                diskInfo:
                  type: object
                  description: Disk usage information.
                  properties:
                    total:
                      type: number
                      format: long
                      description: Total disk space in bytes.
                      example: 20735209472
                    used:
                      type: number
                      format: long
                      description: Used disk space in bytes.
                      example: 120324096
                    free:
                      type: number
                      format: long
                      description: Free disk space in bytes.
                      example: 19537997824
                network:
                  type: object
                  description: Current network utilization on the Appliance.
                  properties:
                    busiestNic:
                      type: string
                      description: The name of the NIC that's most used.
                      example: eth1
                    dropin:
                      type: number
                      description: Number of inbound packets dropped for the whole uptime.
                      example: 2563
                    dropout:
                      type: number
                      description: Number of outbound packets dropped for the whole uptime.
                      example: 120
                    rxSpeed:
                      type: string
                      description: >-
                        The speed of the inbound network activity on the busiest NIC.
                        The average is taken for the last 10 seconds.
                      example: 5.77 Kbps
                    txSpeed:
                      type: string
                      description: >-
                        The speed of the outbound network activity on the busiest NIC.
                        The average is taken for the last 10 seconds.
                      example: 8.53 Kbps
                    ips:
                      type: object
                      description: IPs of the Appliance per NIC.
                      additionalProperties:
                        type: array
                        items:
                          type: string
                      example:
                        eth0:
                          - 10.0.0.1
                          - abba::cafe
                        eth1:
                          - 200.123.123.12
                upgrade:
                  type: object
                  description: Upgrade Status if there is one going.
                  properties:
                    status:
                      type: string
                      description: The Upgrade status
                      example: installing
                    details:
                      type: string
                      description: Optional details for the current Upgrade Status.
                      example: a reboot is required for the upgrade to go into effect
                customizationName:
                  type: string
                  description: The name of the Appliance Customization if one is assigned to this Appliance.
                  example: MyAgent
  AppDiscovery:
    allOf:
      - $ref: '#/definitions/BaseStats'
      - $ref: './common.yml#/definitions/ResultListBase'
      - type: object
        properties:
          distinctAppCount:
            type: number
            description: The number of total distinct Discovered Apps.
            example: 15
          data:
            type: array
            items:
              type: object
              description: A Discovered App.
              properties:
                app:
                  type: string
                  description: The app name, with the domain field it makes up the discovered hostname.
                  example: anew.service
                domain:
                  type: string
                  description: The domain name as configured.
                  example: internal.company.com
                accessCount:
                  type: number
                  description: Number of unique users have attempted to access this app.
                  example: 12
                ips:
                  type: array
                  description: The resolved IP addresses for this app.
                  items:
                    type: string
                    example: 10.10.10.2
                distinguishedNames:
                  type: array
                  description: A list of distinguished names that tried to access this app.
                  items:
                    type: object
                    properties:
                      username:
                        type: string
                        description: The distinguished user name.
                        example: john.doe
                      deviceId:
                        type: string
                        description: The device ID.
                        example: 052a5af1-8098-4809-a558-2803843a5c38
                      provider:
                        type: string
                        description: The provider name.
                        example: AD
  TopEntitlements:
    allOf:
      - $ref: '#/definitions/BaseStats'
      - $ref: './common.yml#/definitions/ResultListBase'
      - type: object
        properties:
          data:
            type: array
            items:
              type: object
              description: >-
                A Top Entitlement. The key is the Entitlement name and the value is the access count.
              additionalProperties:
                type: number
            example:
              - accounting: 566837594
              - active_directory: 34638
  ActiveSessions:
    allOf:
      - $ref: '#/definitions/BaseStats'
      - $ref: './common.yml#/definitions/ResultList'
      - type: object
        properties:
          distinctUserCount:
            type: number
            description: The number of total Distinct Users currently active.
            example: 645
          data:
            type: array
            items:
              allOf:
                - $ref: '#/definitions/BaseActiveSession'
                - type: object
                  description: An Active Client Session.
                  properties:
                    gateway:
                      type: string
                      description: The Gateway name reporting the Active Client Session.
                      example: aws-gateway-1
                    loginTime:
                      type: string
                      format: date-time
                      description: When the Client was logged into this Gateway.
                    ip:
                      type: string
                      description: The IP of the Client as seen by the Gateway.
                      example: 104.210.144.101
                    allocatedIp:
                      type: string
                      description: The Allocated IPv4 IP used for tunneling by the Client.
                      example: 10.10.10.25
                    allocatedIpV6:
                      type: string
                      description: The Allocated IPv6 IP used for tunneling by the Client.
                      example: '2001:db8:0:0:0:ff00:42:8329'
          geolocationQuery:
            $ref: '#/definitions/GeolocationQuery'
  ActiveSessionsDn:
    allOf:
      - $ref: '#/definitions/BaseStats'
      - $ref: './common.yml#/definitions/ResultList'
      - type: object
        properties:
          data:
            type: array
            items:
              allOf:
                - $ref: '#/definitions/BaseActiveSession'
                - type: object
                  description: A client and its active sessions.
                  properties:
                    gateways:
                      type: array
                      description: The names of gateways reporting active client sessions of the user
                      items:
                        type: string
                        example: aws-gateway-1
          geolocationQuery:
            $ref: '#/definitions/GeolocationQuery'
  DashboardSessionsDto:
    type: object
    properties:
      totalCount:
        type: integer
        description: The total count of active sessions.
      geoIpData:
        type: array
        items:
          $ref: '#/definitions/SessionGeoData'
        description: Geolocation data related to active sessions.
      versions:
        additionalProperties:
          $ref: '#/definitions/ClientVersionSupport'
  SessionGeoData:
    type: object
    properties:
      sessionCount:
        type: integer
        description: The count of sessions for this geolocation.
      latitude:
        type: number
        format: double
      longitude:
        type: number
        format: double
      countryCode:
        type: string
        description: The country code associated with the geolocation.
      continentCode:
        type: string
        description: The continent code associated with the geolocation.
      ips:
        type: array
        items:
          type: string
        description: The IP addresses associated with the sessions in this geolocation.
  ClientVersionSupport:
    type: object
    description: Information about the client versions in use.
    properties:
      supportStatus:
        type: string
        description: The support status of the client version.
      sessionCount:
        type: integer
        description: The count of sessions using this client version.
  SessionInfoDistinguishedName:
    type: object
    properties:
      deviceId:
        type: string
        format: uuid
        description: The device ID, same as the one in the Distinguished Name.
        example: 4c07bc67-57ea-42dd-b702-c2d6c45419fc
      username:
        type: string
        description: The username, same as the one in the Distinguished Name.
        example: user
      providerName:
        type: string
        description: The provider name of the user, same as the one in the Distinguished Name.
        example: ldap
      data:
        type: object
        description: >-
          The session details per Gateway.
          The key is the Appliance name and the value contains the Active Client Session details.
        additionalProperties:
          type: object
          description: Session Details reported by the Gateway.
          properties:
            userClaims:
              type: object
              additionalProperties: true
              example:
                username: admin
                groups:
                  - 'CN=test,OU=unit,DC=company,DC=com'
                  - 'CN=finance,OU=unit,DC=company,DC=com'
            deviceClaims:
              type: object
              additionalProperties: true
              example:
                os:
                  name: Microsoft Windows 10 Pro
                  platform: x64
                  type: desktop
                isUserAdmin: true
                language: en-us
            systemClaims:
              type: object
              additionalProperties: true
              example:
                connectTime: 2018-11-16T13:25:15.672Z
                tunIPv4: 15.0.0.24
                clientSrcIP: 192.168.111.184
            entitlementInfos:
              type: object
              description: Entitlement information reported by the Gateway. The key is the Entitlement name.
              additionalProperties:
                type: object
                description: Entitlement details.
                properties:
                  access:
                    type: boolean
                    description: Whether the Entitlement is accessible or not.
                  conditionLogic:
                    type: string
                    description: Whether all the Conditions must succeed to have access to this Entitlement or just one.
                    enum:
                      - and
                      - or
                  conditionResults:
                    type: object
                    description: >-
                      Current results of the Condition evaluations.
                      Entitlement access is decided according to these results. The key is the Condition name.
                    additionalProperties:
                      type: boolean
                    example:
                      MFASuccess: true
                      InternalNetwork: false
                  firewallRules:
                    type: array
                    description: >-
                      Current Firewall Rules assigned after evaluating all the Entitlements, Conditions and
                      Name Resolvers.
                    items:
                      type: object
                      description: Firewall Rule.
                      properties:
                        name:
                          type: string
                          description: Name of the rule.
                          example: entitlement-1
                        protocol:
                          type: string
                          description: The protocol for the Firewall Rule.
                          example: tcp
                        direction:
                          type: string
                          description: The direction of the Firewall Rrule.
                          example: up
                        action:
                          type: string
                          description: The action for the Firewall Rule.
                          example: allow
                        subnets:
                          type: array
                          description: The subnets the Firewall Rule applies to.
                          items:
                            type: string
                            example: 172.31.4.105
                        urls:
                          type: array
                          description: The URLs the Firewall Rule applies to in case of http_up subtype.
                          items:
                            type: string
                            example: "https://server.company.com/test"
                        ports:
                          type: array
                          description: The ports the Firewall Rule applies to.
                          items:
                            type: string
                            example: 443
                        types:
                          type: array
                          description: The ICMP types the Firewall Rule applies to. Valid for ICMP.
                          items:
                            type: string
                            example: 0-255
                  policyNames:
                    type: array
                    description: Names of the Policies that has granted this Entitlement.
                    items:
                      type: string
                      example: Finance
                  primarySite:
                    type: string
                    description: The name of the primary Site if this entitlements is currently active as part of backup Site feature.
                    example: AWS Site
                  domainEntitlement:
                    type: boolean
                    description: Whether the Entitlement has only domain:// type actions. When that is the case, the firewallRules being empty is a normal scenario.
            discoveredApps:
              type: array
              description: >-
                The Discovered Apps by this Gateway.
                Note that this API does not filter out the existing Entitlements like the App Discovery API
                does.
              items:
                type: string
                description: Full hostname for the Discovered App.
                example: new-service.internal.company.com
            vpn:
              type: object
              description: VPN details of the session
              additionalProperties: true
            site:
              type: string
              description: The Site name for the Gateway.
              example: AWS Site
  UserLogins:
    allOf:
      - $ref: '#/definitions/BaseStats'
      - type: object
        properties:
          data:
            type: object
            description: >-
              A dictionary of User Logins Per Hour.
              The key is the hour, the value is a map of Users Logins per controller.
              For example 8: {'controller1.company.com' : '25', 'controller2.company.com' : '5', 'total': '30'} means, between 08:00 - 09:00, 25 Logins have occurred to
              'controller1.company.com' and 5 Logins to 'controller2.company.com' and total Logins to all controllers in this period is 30.
              Times are UTC based and if the hour number is after the current time, it represents the day
              before.
            additionalProperties:
              type: number
              description: Number of User Logins (Claims Token retrieval) for this hour.
            example:
              0: { 'controller1.company.com': '100', 'controller2.company.com': '20', 'total': '120' }
              1: { 'controller1.company.com': '42', 'controller2.company.com': '100', 'total': '142' }
              2: { 'controller1.company.com': '165', 'total': '165' }
              3: { 'controller1.company.com': '25', 'controller2.company.com': '80', 'total': '105' }
  OnBoardedDevices:
    allOf:
      - $ref: '#/definitions/BaseStats'
      - type: object
        properties:
          data:
            type: object
            description: >-
              A dictionary of Device On-Boardings Per hour.
              The key is the hour, the value is the amount of on-boards.
              For example 8:24 means, between 08:00 - 09:00, 24 on-boards have occurred.
              Times are UTC based and if the hour number is after the current time, it represents the day
              before.
            additionalProperties:
              type: number
              description: Number of On-Boardings for this hour.
            example:
              0: 120
              1: 142
              2: 165
              3: 105
  BaseActiveSession:
    allOf:
      - $ref: './common.yml#/definitions/DeviceAndUser'
      - type: object
        properties:
          geoIpLatitude:
            type: number
            format: double
            description: GeoIP Latitude of the client.
            example: 59.408
          geoIpLongitude:
            type: number
            format: double
            description: GeoIP Latitude of the client.
            example: 17.8678
          hostname:
            type: string
            description: Hostname or Device name reported by the Client as Device Claim.
            example: cmp325
          osFamily:
            type: string
            description: Family of the operating system of the Client.
            example: windows
          osName:
            type: string
            description: Name of the operating system of the Client.
            example: Microsoft Windows 10 Enterprise N
          osParent:
            type: string
            description: Parent of the operating system of the Client. Typically available for Linux.
            example: fedora
          clientVersion:
            type: string
            description: Client version.
            example: 6.1.2-32120-release
          clientType:
            type: string
            description: Client type.
            example: headless
          clientSupport:
            type: string
            description: The support status of the client.
            enum:
              - full
              - partial
              - none
  GeolocationQuery:
    type: object
    description: Query parameters for finding active sessions in a given radius in the world.
    properties:
      latitude:
        type: number
        format: double
        description: Latitude of the central point of the query.
        example: 59.408
      longitude:
        type: number
        format: double
        description: Longitude of the central point of the query.
        example: 17.8678
      radiusKilometers:
        type: number
        format: double
        description: Radius of the query in kilometers.
        example: 200
