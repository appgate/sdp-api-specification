admin-messages:
  get:
    summary: Get the Admin Messages.
    description: >-
      Get a list of all Admin Messages generated by the system for the past 7 days.
      It includes duplicate messages generated over time.
      Use "/summarize" to get distinct messages like the Admin UI.
    tags:
      - Admin Messages
    parameters:
      - $ref: './common.yml#/parameters/authorization'
    responses:
      '200':
        description: List of Admin Messages.
        content:
          application/json:
            schema:
              properties:
                data:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                        description: Randomly generated UUID.
                        example: 4c07bc67-57ea-42dd-b702-c2d6c45419fc
                      level:
                        type: string
                        description: The severity of the message.
                        enum:
                          - Information
                          - Warning
                          - Error
                          - Critical
                      category:
                        type: string
                        description: Message category.
                        enum:
                          - Configuration
                          - Connectivity
                      message:
                        type: string
                        description: The message.
                        example: Identity Provider "local" does not have IP Pool assigned.
                      source:
                        type: string
                        description: >-
                          The source of the message.
                          If it's Controller specific message, it will be "Controller".
                          Otherwise it will be the hostname of the source Appliance.
                        example: Controller
                      created:
                        type: string
                        format: date-time
                        description: When the Admin Message generated.
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
  delete:
    summary: Delete all Admin Messages.
    description: Delete all Admin Messages.
    tags:
      - Admin Messages
    parameters:
      - $ref: './common.yml#/parameters/authorization'
    responses:
      '204':
        description: Admin messages were deleted successfully.
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
admin-messages-summarize:
  get:
    summary: Get a summary of Admin Messages.
    description: >-
      List all summarized Admin Messages generated by the system for the past 7 days.
      This API call is recommended as some of the Admin Messages may be duplicated too much in case of a configuration
      problem on a heavy loaded system.
    tags:
      - Admin Messages
    parameters:
      - $ref: './common.yml#/parameters/authorization'
    responses:
      '200':
        description: Summary of Admin Messages.
        content:
          application/json:
            schema:
              properties:
                data:
                  type: array
                  items:
                    type: object
                    properties:
                      level:
                        type: string
                        description: The severity of the Admin Message.
                        enum:
                          - Information
                          - Warning
                          - Error
                          - Critical
                      category:
                        type: string
                        description: Message category.
                        enum:
                          - Configuration
                          - Connectivity
                      message:
                        type: string
                        description: The Admin Message.
                        example: Identity Provider "local" does not have IP Pool assigned.
                      source:
                        type: string
                        description: >-
                          The source of the Admin Message.
                          If it's a Controller specific message, it will be "Controller".
                          Otherwise it will be the hostname of the source appliance.
                        example: Controller
                      created:
                        type: string
                        format: date-time
                        description: When the Admin Message generated the last time.
                      count:
                        type: number
                        description: Number of times this Admin Message was generated.
                        example: 152
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'

stats-appliances:
  get:
    summary: Get Appliance Stats.
    description: >-
      Get Stats and status of the active appliances.
      This API makes the controller to query every active appliance for status.
      The operation may take long if one or more appliances take long to respond.
    tags:
      - Appliance Stats
    parameters:
      - $ref: './common.yml#/parameters/authorization'
    responses:
      '200':
        description: Active Appliances stats.
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/definitions/BaseStats'
                - type: object
                  properties:
                    controllerCount:
                      type: number
                      description: The number of active Appliances with the Controller role enabled.
                      example: 2
                    gatewayCount:
                      type: number
                      description: The number of active Appliances with the Gateway role enabled.
                      example: 12
                    applianceCount:
                      type: number
                      description: The number of active Appliances in total.
                      example: 14
                    logServerCount:
                      type: number
                      description: The number of active Appliances with the LogServer role enabled.
                      example: 1
                    logForwarderCount:
                      type: number
                      description: The number of active Appliances with the LogForwarder role enabled.
                      example: 0
                    connectorCount:
                      type: number
                      description: The number of active Appliances with the Connector role enabled.
                      example: 6
                    portalCount:
                      type: number
                      description: The number of active Appliances with the Portal role enabled.
                      example: 6
                    data:
                      type: array
                      items:
                        type: object
                        description: An active Appliance status details.
                        properties:
                          id:
                            type: string
                            format: uuid
                            description: ID of the Appliance.
                            example: 4c07bc67-57ea-42dd-b702-c2d6c45419fc
                          name:
                            type: string
                            description: Name of the Appliance.
                            example: Controller1
                          online:
                            type: boolean
                            description: Whether the Appliance is reachable by the Controller or not. Deprecated as of 5.1. "status" field will be set to "offline" instead.
                            deprecated: true
                          version:
                            type: string
                            description: The Appliance build version.
                            example: 4.2.0-12161-release
                          state:
                            type: string
                            description: State of the Appliance. For internal use.
                            example: controller_ready
                          volumeNumber:
                            type: number
                            description: The volume number in use.
                            example: 1
                          status:
                            type: string
                            description: Aggregated status of the Appliance.
                            enum:
                              - healthy
                              - busy
                              - warning
                              - error
                              - n/a
                              - offline
                          controller:
                            $ref: '#/definitions/ApplianceRole'
                          logServer:
                            $ref: '#/definitions/ApplianceRole'
                          logForwarder:
                            $ref: '#/definitions/ApplianceRole'
                          gateway:
                            $ref: '#/definitions/ApplianceWithSessionsRole'
                          connector:
                            $ref: '#/definitions/ApplianceWithSessionsRole'
                          portal:
                            $ref: '#/definitions/ApplianceWithSessionsRole'
                          appliance:
                            $ref: '#/definitions/ApplianceWithSessionsRole'
                          cpu:
                            type: number
                            format: float
                            description: Current CPU utilization % on the Appliance.
                            example: 1.2
                          memory:
                            type: number
                            format: float
                            description: Current memory reserved % on the Appliance.
                            example: 21.5
                          disk:
                            type: number
                            format: float
                            description: Current disk usage % on the Appliance.
                            example: 1.2
                          network:
                            type: object
                            description: Current network utilization on the Appliance.
                            properties:
                              busiestNic:
                                type: string
                                description: The name of the NIC that's most used.
                                example: eth1
                              dropin:
                                type: number
                                description: Number of inbound packets dropped for the whole uptime.
                                example: 2563
                              dropout:
                                type: number
                                description: Number of outbound packets dropped for the whole uptime.
                                example: 120
                              rxSpeed:
                                type: string
                                description: >-
                                  The speed of the inbound network activity on the busiest NIC.
                                  The average is taken for the last 10 seconds.
                                example: 5.77 Kbps
                              txSpeed:
                                type: string
                                description: >-
                                  The speed of the outbound network activity on the busiest NIC.
                                  The average is taken for the last 10 seconds.
                                example: 8.53 Kbps
                              ips:
                                type: object
                                description: IPs of the Appliance per NIC.
                                additionalProperties:
                                  type: array
                                  items:
                                    type: string
                                example:
                                  eth0:
                                    - 10.0.0.1
                                    - abba::cafe
                                  eth1:
                                    - 200.123.123.12
                          upgrade:
                            type: object
                            description: Upgrade Status if there is one going.
                            properties:
                              status:
                                type: string
                                description: The Upgrade status
                                example: installing
                              details:
                                type: string
                                description: Optional details for the current Upgrade Status.
                                example: a reboot is required for the upgrade to go into effect
                          customizationName:
                            type: string
                            description: The name of the Appliance Customization if one is assigned to this Appliance.
                            example: MyAgent
app-discovery:
  get:
    summary: Get Discovered Apps.
    description: >-
      Get Discovered Apps for the last 7 days. Rebooting a Gateway resets the Discovered Apps for that Gateway.
      This API makes the Controller to query every Gateway in the system to collect the statistics.
      The operation may take long if one or more appliances take long to respond.
    tags:
      - Discovered Apps
    parameters:
      - $ref: './common.yml#/parameters/authorization'
      - $ref: './common.yml#/parameters/query'
      - $ref: './common.yml#/parameters/range'
      - $ref: './common.yml#/parameters/orderBy'
      - $ref: './common.yml#/parameters/descending'
      - $ref: './common.yml#/parameters/filterBy'
    responses:
      '200':
        description: Discovered Apps.
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/definitions/BaseStats'
                - $ref: './common.yml#/definitions/ResultList'
                - type: object
                  properties:
                    distinctAppCount:
                      type: number
                      description: The number of total distinct Discovered Apps.
                      example: 15
                    data:
                      type: array
                      items:
                        type: object
                        description: A Discovered App.
                        properties:
                          app:
                            type: string
                            description: The app name, with the domain field it makes up the discovered hostname.
                            example: anew.service
                          domain:
                            type: string
                            description: The domain name as configured.
                            example: internal.company.com
                          accessCount:
                            type: number
                            description: How many access attempts occurred for this app.
                            example: 12
                          ips:
                            type: array
                            description: The resolved IP addresses for this app.
                            items:
                              type: string
                              example: 10.10.10.2
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
top-entitlements:
  get:
    summary: Get Top Entitlements.
    description: >-
      Get the (most used) Top Entitlements for the last 7 days.
      Each Gateway keeps track of the most used 20 Entitlements and they are aggregated on the Controller.
      Number of  Entitlements in this stats varies accordingly.
      Rebooting a Gateway resets the most used Entitlements for that Gateway.
      This API makes the Controller to query every Gateway in the system to collect the statistics.
      The operation may take long if one or more Gateways take long to respond.
    tags:
      - Top Entitlements
    parameters:
      - $ref: './common.yml#/parameters/authorization'
      - $ref: './common.yml#/parameters/range'
      - $ref: './common.yml#/parameters/orderBy'
      - $ref: './common.yml#/parameters/descending'
      - $ref: './common.yml#/parameters/filterBy'
    responses:
      '200':
        description: Top Entitlements.
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/definitions/BaseStats'
                - type: object
                  properties:
                    range:
                      type: string
                      description: >-
                        The range applied to the list. Format: -/. 3-5/8 means, out of 8 count (query affects the total)
                        , the items between the (including) 3rd and the 5th are returned.
                      example: 0-30/54
                    orderBy:
                      type: string
                      description: The field name used to sort the list.
                      example: name
                    descending:
                      type: boolean
                      description: Whether the sorting is applied descending or ascending.
                    data:
                      type: array
                      items:
                        type: object
                        description: >-
                          A Top Entitlement. The key is the Entitlement name and the value is the access count.
                        additionalProperties:
                          type: number
                      example:
                        - accounting: 566837594
                        - active_directory: 34638
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
active-sessions:
  get:
    summary: Get Active Client Sessions.
    description: >-
      Get currently Active Client Sessions.
      This API makes the Controller to query every Gateway in the system to collect the session data.
      The operation may take long if one or more Gateways take long to respond.
    tags:
      - Active Sessions
    parameters:
      - $ref: './common.yml#/parameters/authorization'
      - $ref: './common.yml#/parameters/query'
      - $ref: './common.yml#/parameters/range'
      - $ref: './common.yml#/parameters/orderBy'
      - $ref: './common.yml#/parameters/descending'
      - $ref: './common.yml#/parameters/filterBy'
    responses:
      '200':
        description: >-
          Active Client Sessions per Gateway.
          Note that the Appgate SDP Admin UI aggregates this data to list device&users.
          Disconnected Clients disappear after 5 minutes.
          When a Client fails over to another Gateway, the API may return the Client on multiple Gateways until during
          this period.
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/definitions/BaseStats'
                - $ref: './common.yml#/definitions/ResultList'
                - type: object
                  properties:
                    distinctUserCount:
                      type: number
                      description: The number of total Distinct Users currently active.
                      example: 645
                    data:
                      type: array
                      items:
                        allOf:
                          - $ref: './common.yml#/definitions/DeviceAndUser'
                          - type: object
                            description: An Active Client Session.
                            properties:
                              gateway:
                                type: string
                                description: The Gateway name reporting the Active Client Session.
                                example: aws-gateway-1
                              loginTime:
                                type: string
                                format: date-time
                                description: When the Client was logged into this Gateway.
                              ip:
                                type: string
                                description: The IP of the Client as seen by the Gateway.
                                example: 104.210.144.101
                              allocatedIp:
                                type: string
                                description: The Allocated IPv4 IP used for tunneling by the Client.
                                example: 10.10.10.25
                              allocatedIpV6:
                                type: string
                                description: The Allocated IPv6 IP used for tunneling by the Client.
                                example: '2001:db8:0:0:0:ff00:42:8329'
                              hostname:
                                type: string
                                description: Hostname or Device name reported by the Client as Device Claim.
                                example: cmp325
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
session-info-distinguished-name:
  get:
    summary: Get details of a specific Active Client Session.
    description: >-
      Get the details of a specific Active Client Session from all Gateways.
      This API makes the Controller to query very Gateway in the system to collect the session data.
      The operation may take long if one or more Gateways take long to respond.
    tags:
      - Active Sessions
    parameters:
      - $ref: './common.yml#/parameters/authorization'
      - $ref: './common.yml#/parameters/distinguishedName'
    responses:
      '200':
        description: >-
          Details of an Active Client Session per Gateway.
          Disconnected Clients disappear after 5 minutes.
          When a Client fails over to another Gateway, the API may return the Client on multiple Gateways until during
          this period.
        content:
          application/json:
            schema:
              type: object
              properties:
                deviceId:
                  type: string
                  format: uuid
                  description: The device ID, same as the one in the Distinguished Name.
                  example: 4c07bc67-57ea-42dd-b702-c2d6c45419fc
                username:
                  type: string
                  description: The username, same as the one in the Distinguished Name.
                  example: user
                providerName:
                  type: string
                  description: The provider name of the user, same as the one in the Distinguished Name.
                  example: ldap
                data:
                  type: object
                  description: >-
                    The session details per Gateway.
                    The key is the Gateway hostname and the value contains the Active Client Session details.
                  additionalProperties:
                    type: object
                    description: Session Details reported by the Gateway.
                    properties:
                      userClaims:
                        type: object
                        additionalProperties: true
                        example:
                          username: admin
                          groups:
                            - 'CN=test,OU=unit,DC=company,DC=com'
                            - 'CN=finance,OU=unit,DC=company,DC=com'
                      deviceClaims:
                        type: object
                        additionalProperties: true
                        example:
                          os:
                            name: Microsoft Windows 10 Pro
                            platform: x64
                            type: desktop
                          isUserAdmin: true
                          language: en-us
                      systemClaims:
                        type: object
                        additionalProperties: true
                        example:
                          connectTime: 2018-11-16T13:25:15.672Z
                          tunIPv4: 15.0.0.24
                          clientSrcIp: 192.168.111.184
                      entitlementInfos:
                        type: object
                        description: Entitlement information reported by the Gateway. The key is the Entitlement name.
                        additionalProperties:
                          type: object
                          description: Entitlement details.
                          properties:
                            conditionResults:
                              type: object
                              description: >-
                                Current results of the Condition evaluations.
                                Entitlement access is decided according to these results. The key is the Condition name.
                              additionalProperties:
                                type: boolean
                              example:
                                MFASuccess: true
                                InternalNetwork: false
                            firewallRules:
                              type: array
                              description: >-
                                Current Firewall Rules assigned after evaluating all the Entitlements, Conditions and
                                Name Resolvers.
                              items:
                                type: object
                                description: Firewall Rule.
                                properties:
                                  name:
                                    type: string
                                    description: Name of the rule.
                                    example: entitlement-1
                                  protocol:
                                    type: string
                                    description: The protocol for the Firewall Rule.
                                    example: tcp
                                  direction:
                                    type: string
                                    description: The direction of the Firewall Rrule.
                                    example: up
                                  action:
                                    type: string
                                    description: The action for the Firewall Rule.
                                    example: allow
                                  subnets:
                                    type: array
                                    description: The subnets the Firewall Rule applies to.
                                    items:
                                      type: string
                                      example: 172.31.4.105
                                  urls:
                                    type: array
                                    description: The URLs the Firewall Rule applies to in case of http_up subtype.
                                    items:
                                      type: string
                                      example: "https://server.company.com/test"
                                  ports:
                                    type: array
                                    description: The ports the Firewall Rule applies to.
                                    items:
                                      type: string
                                      example: 443
                                  types:
                                    type: array
                                    description: The ICMP types the Firewall Rule applies to. Valid for ICMP.
                                    items:
                                      type: string
                                      example: 0-255
                            policyNames:
                              type: array
                              description: Names of the Policies that has granted this Entitlement.
                              items:
                                type: string
                                example: Finance
                      discoveredApps:
                        type: array
                        description: >-
                          The Discovered Apps by this Gateway.
                          Note that this API does not filter out the existing Entitlements like the App Discovery API
                          does.
                        items:
                          type: string
                          description: Full hostname for the Discovered App.
                          example: new-service.internal.company.com
                      vpn:
                        type: object
                        description: VPN details of the session
                        additionalProperties: true
                      site:
                        type: string
                        description: The Site name for the Gateway.
                        example: AWS Site
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '404':
        $ref: './common.yml#/responses/NotFoundError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
user-logins:
  get:
    summary: Get User Logins Per Hour.
    description: >-
      Get the User Logins Per Hour for the last 24 hours.
    tags:
      - User Logins Per Hour
    parameters:
      - $ref: './common.yml#/parameters/authorization'
    responses:
      '200':
        description: User Logins Per Hour.
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/definitions/BaseStats'
                - type: object
                  properties:
                    data:
                      type: object
                      description: >-
                        A dictionary of User Logins Per Hour.
                        The key is the hour, the value is a map of Users Logins per controller.
                        For example 8: {'controller1.company.com' : '25', 'controller2.company.com' : '5', 'total': '30'} means, between 08:00 - 09:00, 25 Logins have occurred to
                        'controller1.company.com' and 5 Logins to 'controller2.company.com' and total Logins to all controllers in this period is 30.
                        Times are UTC based and if the hour number is after the current time, it represents the day
                        before.
                      additionalProperties:
                        type: number
                        description: Number of User Logins (Claims Token retrieval) for this hour.
                      example:
                        0: {'controller1.company.com': '100', 'controller2.company.com': '20', 'total': '120'}
                        1: {'controller1.company.com': '42', 'controller2.company.com': '100', 'total': '142'}
                        2: {'controller1.company.com': '165', 'total': '165'}
                        3: {'controller1.company.com': '25', 'controller2.company.com': '80', 'total': '105'}
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
on-boarded-devices:
  get:
    summary: Get Device On-Boardings Per Hour.
    description: >-
      Get the Device On-Boardings Per Hour for the last 24 hours.
    tags:
      - Devices On-Boarded Per Hour
    parameters:
      - $ref: './common.yml#/parameters/authorization'
    responses:
      '200':
        description: Device On-Boardings Per Hour.
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/definitions/BaseStats'
                - type: object
                  properties:
                    data:
                      type: object
                      description: >-
                        A dictionary of Device On-Boardings Per hour.
                        The key is the hour, the value is the amount of on-boards.
                        For example 8:24 means, between 08:00 - 09:00, 24 on-boards have occurred.
                        Times are UTC based and if the hour number is after the current time, it represents the day
                        before.
                      additionalProperties:
                        type: number
                        description: Number of On-Boardings for this hour.
                      example:
                        0: 120
                        1: 142
                        2: 165
                        3: 105
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
failed-authentications:
  get:
    summary: Get failed authentications per hour.
    description: >-
      Get the failed authentications per hour for the last 24 hours.
    tags:
      - Failed Authentications Per Hour
    parameters:
      - $ref: './common.yml#/parameters/authorization'
    responses:
      '200':
        description: Failed authentications per hour.
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/definitions/BaseStats'
                - type: object
                  properties:
                    data:
                      type: object
                      description: >-
                        A dictionary of failed authentications per hour.
                        The key is the hour, the value is the amount of failed authentications.
                        For example '"8":24' means, between 08:00 - 09:00, 24 failed authentications have occurred.
                        Times are UTC based and if the hour number is after the current time, it represents the day before.
                      additionalProperties:
                        type: number
                        description: The amount of failed authentications for this hour.
                      example:
                        0: 120
                        1: 142
                        2: 165
                        3: 105
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'

definitions:
  BaseStats:
    type: object
    properties:
      name:
        type: string
        description: User-friendly name for the stats.
        example: appliances
      creationDate:
        type: string
        format: 'date-time'
        description: The time the stats was generated.
      refreshInterval:
        type: number
        description: Recommended refresh interval in minutes.
        example: 1
  ApplianceRole:
    type: object
    description: Status of the given role for an Appliance.
    properties:
      status:
        type: string
        description: Status of the role.
        enum:
          - healthy
          - busy
          - warning
          - error
          - n/a
      details:
        type: string
        description: Optional details for extra information like error messages.
        example: Cannot reach appliance. Please check Controller logs.
  ApplianceWithSessionsRole:
    allOf:
      - $ref: '#/definitions/ApplianceRole'
      - type: object
        properties:
          numberOfSessions:
            type: integer
            description: Number of active sessions on the Gateway or Portal.
            example: 156
