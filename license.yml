license:
  get:
    summary: Get the current License.
    description: Get the current License.
    tags:
      - License
    responses:
      '200':
        $ref: '#/responses/LicenseDetails'
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
  post:
    summary: Upload a new License.
    description: Upload a new License and override the existing one.
    tags:
      - License
    responses:
      '200':
        $ref: '#/responses/License'
      '400':
        $ref: './common.yml#/responses/JsonError'
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '422':
        $ref: './common.yml#/responses/ValidationError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
    requestBody:
      $ref: '#/requestBodies/LicenseImport'
  delete:
    summary: Delete all Licenses.
    description: Delete all Licenses to revert to the Built-in License.
    deprecated: true
    tags:
      - License
    responses:
      '204':
        description: Licenses were deleted successfully.
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
license-id:
  delete:
    summary: Delete a specific License.
    description: Delete a specific License from list of Licenses.
    tags:
      - License
    parameters:
      - $ref: './common.yml#/parameters/id'
    responses:
      '204':
        description: License was deleted successfully.
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '404':
        $ref: './common.yml#/responses/NotFoundError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
license-next:
  get:
    summary: Get the next License.
    description: >-
      Get the next License which will be activated when CA certificate switch occurs.
      Licenses are bound to the CA Certificate.
    tags:
      - License
    responses:
      '200':
        $ref: '#/responses/LicenseDetails'
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '422':
        $ref: './common.yml#/responses/ValidationError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
  post:
    summary: Upload a new next License.
    description: Upload a new next License to be switched when CA certificate is switched.
    tags:
      - License
    responses:
      '200':
        $ref: '#/responses/License'
      '400':
        $ref: './common.yml#/responses/JsonError'
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '422':
        $ref: './common.yml#/responses/ValidationError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
    requestBody:
      $ref: '#/requestBodies/LicenseImport'
  delete:
    summary: Delete the next License.
    description: Delete the next License.
    tags:
      - License
    responses:
      '204':
        description: License was deleted successfully.
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'

responses:
  LicenseDetails:
    description: License details including usage.
    content:
      application/json:
        schema:
          $ref: '#/definitions/LicenseDetails'
  License:
    description: License details.
    content:
      application/json:
        schema:
          $ref: '#/definitions/License'

requestBodies:
  LicenseImport:
    description: License import.
    content:
      application/json:
        schema:
          $ref: '#/definitions/LicenseImport'
    required: true

definitions:
  LicenseDetails:
    type: object
    description: License details and current usage.
    properties:
      licenses:
        type: array
        items:
          $ref: '#/definitions/License'
      entitled:
        $ref: '#/definitions/LicenseEntitlement'
      requestCode:
        type: string
        description: Request code for the license. Use this code to get a license.
          It's based on the CA certificate.
      usage:
        type: object
        description: License usage information.
        properties:
          users:
            type: number
            description: The amount of licensed users in the system at present.
            example: 152
          portalUsers:
            type: number
            description: The amount of licensed portal users in the system at present.
            example: 24
          serviceUsers:
            type: number
            description: The amount of licensed service users in the system at present.
            example: 2
          sites:
            type: number
            description: The amount of Sites in the system at present.
            example: 3
          connectorGroups:
            type: number
            description: The amount of grouped Connector clients in the system at present.
            example: 4
          multiUserClients:
            type: number
            description: The amount of licensed multi-user clients in the system at present.
            example: 10
          clientTypes:
            type: object
            description: Counts of the current client types in the system at present.
            properties:
              full:
                type: number
                description: The amount of full client types in the system at present.
                example: 10
              full_multi:
                type: number
                description: The amount of full multi client types in the system at present.
                example: 10
              full_always_on:
                type: number
                description: The amount of full always on client types in the system at present.
                example: 10
              lite:
                type: number
                description: The amount of lite client types in the system at present.
                example: 10
              headless:
                type: number
                description: The amount of headless client types in the system at present.
                example: 10
              headless_always_on:
                type: number
                description: The amount of full always on client types in the system at present.
                example: 10
              connector:
                type: number
                description: The amount of connector client types in the system at present.
                example: 10
              sso:
                type: number
                description: The amount of sso client types in the system at present.
                example: 10
              web:
                type: number
                description: The amount of web client types in the system at present.
                example: 10
              unknown:
                type: number
                description: The amount of unknown client types in the system at present.
                example: 10
          mfaProviders:
            type: number
            description: The amount of non-built-in MFA Providers in the system at present.
            example: 1
          deviceScripts:
            type: number
            description: The amount of non-built-in Device Claim Scripts in the system at present.
            example: 3
          criteriaScripts:
            type: number
            description: The amount of non-built-in Criteria Scripts in the system at present.
            example: 3
          entitlementScripts:
            type: number
            description: The amount of non-built-in EntitlementScripts in the system at present.
            example: 3
          userScripts:
            type: number
            description: The amount of non-built-in User Claim Scripts in the system at present.
            example: 3
          fallbackSites:
            type: number
            description: The amount of fallback Sites in the system at present.
            example: 1
          nearestSites:
            type: number
            description: The amount of nearest Sites in the system at present.
            example: 1
          localSites:
            type: number
            description: The amount of local Sites in the system at present.
            example: 1
          profileGroups:
            type: number
            description: The amount of Profile Groups in the system at present.
            example: 2
          applianceCustomizations:
            type: number
            description: The amount of Appliance Customizations in the system at present.
            example: 2
          ringfenceRules:
            type: number
            description: The amount of non-built-in Ringfence Rules in the system at present.
            example: 2
          otpSeeds:
            type: number
            description: The amount of Time-based OTP Seeds in the system at present.
            example: 2
          fido2Devices:
            type: number
            description: The amount of FIDO2 devices in the system at present.
            example: 2
          identityProviders:
            type: object
            description: The amount of non-built-in Identity Providers in the system at present broken out by type.
            properties:
              ldap:
                type: number
              ldapCertificate:
                type: number
              radius:
                type: number
              saml:
                type: number
              oidc:
                type: number
          policies:
            type: object
            description: The amount of Policies in the system at present broken out by type.
            properties:
              access:
                type: number
              stop:
                type: number
              device:
                type: number
              dns:
                type: number
              admin:
                type: number
              mixed:
                type: number
          riskModel:
            type: boolean
            description: Whether the risk model is utilized or not.
  LicenseEntitlement:
    type: object
    description: License entitlement details.
    properties:
      maxUsers:
        type: number
        description: The maximum users allowed by the license.
        example: 200
      maxPortalUsers:
        type: number
        description: The maximum Portal users allowed by the license.
        example: 200
      maxServiceUsers:
        type: number
        description: The maximum Service users allowed by the license.
        example: 200
      usersLeaseTimeHours:
        type: number
        description: >-
          Number of hours User Licenses will be reserved for users before they are reclaimable by others.
        example: 720
      portalUsersLeaseTimeHours:
        type: number
        description: >-
          Number of hours User Licenses will be reserved for Portal users before they are reclaimable by others.
        example: 720
      serviceUsersLeaseTimeHours:
        type: number
        description: >-
          Number of hours User Licenses will be reserved for Service users before they are reclaimable by others.
        example: 720
      maxSites:
        type: number
        description: >-
          The maximum sites allowed by the license.
          If it's the usage details, then it's the amount of sites in the system at present.
        example: 5
      maxAccessPolicies:
        type: number
        description: >-
          The maximum access policies allowed by the license.
          If it's the usage details, then it's the amount of access policies in the system at present.
        example: 5
      maxConnectorGroups:
        type: number
        description: The maximum Connector groups allowed by the license.
        example: 150
      riskEngine:
        type: boolean
        description: Whether the Risk Engine feature is enabled.
      applicationDiscovery:
        type: boolean
        description: Whether the Application Discovery feature is enabled.
      digitalExperienceMonitoring:
        type: boolean
        description: Whether the Digital Experience Monitoring feature is enabled.
  License:
    allOf:
      - $ref: '#/definitions/LicenseEntitlement'
      - type: object
        description: License details.
        properties:
          id:
            type: string
            format: uuid
            description: Unique ID for the license.
            example: 4c07bc67-57ea-42dd-b702-c2d6c45419fc
          version:
            type: number
            description: License version. There can be only one v1 License in the system, while v2 Licenses can be added as extra.
            example: 2
          type:
            type: number
            description: 'Type of the license. 1: production, 2: installation, 3: test, 4: built-in, 5: aws
             built-in, 6: metered'
            example: 2
          request:
            type: string
            description: >-
              Request code for the license. If built-in license is in place, use this code to get a license.
              It's based on the CA certificate.
            example: 1675ab19fe2
          expiration:
            type: string
            format: 'date-time'
            description: The expiration date of the license.
          error:
            type: string
            description: Error message if the License is not invalid.
            example: License has expired.
  LicenseImport:
    type: object
    description: Object to import a new license.
    required:
      - license
    properties:
      license:
        type: string
        description: The license file contents for this Controller (with the matching request code).
