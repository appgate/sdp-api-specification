client-profiles:
  get:
    summary: List all Client Profiles.
    description: List all Client Profiles visible to current user.
    tags:
      - Client Profiles
    parameters:
      - $ref: './common.yml#/parameters/query'
      - $ref: './common.yml#/parameters/range'
      - $ref: './common.yml#/parameters/orderBy'
      - $ref: './common.yml#/parameters/descending'
      - $ref: './common.yml#/parameters/filterBy'
    responses:
      '200':
        description: List of Client Profiles.
        content:
          application/json:
            schema:
              $ref: '#/definitions/ClientProfileList'
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
  post:
    summary: Create a new Client Profile.
    description: Create a new Client Profile.
    tags:
      - Client Profiles
    responses:
      '200':
        description: Created Client Profile.
        content:
          application/json:
            schema:
              $ref: '#/definitions/ClientProfile'
      '400':
        $ref: './common.yml#/responses/JsonError'
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '409':
        $ref: './common.yml#/responses/ConflictError'
      '422':
        $ref: './common.yml#/responses/ValidationError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
    requestBody:
      $ref: '#/requestBodies/ClientProfile'
client-profiles-id:
  get:
    summary: Get a specific Client Profile.
    description: Get a specific Client Profile.
    tags:
      - Client Profiles
    parameters:
      - $ref: './common.yml#/parameters/id'
    responses:
      '200':
        description: Single Client Profile.
        content:
          application/json:
            schema:
              $ref: '#/definitions/ClientProfileDiscriminator'
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '404':
        $ref: './common.yml#/responses/NotFoundError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
  put:
    summary: Update an existing Client Profile.
    description: Update an existing Client Profile.
    tags:
      - Client Profiles
    parameters:
      - $ref: './common.yml#/parameters/id'
    responses:
      '200':
        description: Updated Client Profile.
        content:
          application/json:
            schema:
              $ref: '#/definitions/ClientProfileDiscriminator'
      '400':
        $ref: './common.yml#/responses/JsonError'
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '404':
        $ref: './common.yml#/responses/NotFoundError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '422':
        $ref: './common.yml#/responses/ValidationError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
    requestBody:
      $ref: '#/requestBodies/ClientProfile'
  delete:
    summary: Delete a specific Client Profile.
    description: Delete a specific Client Profile.
    tags:
      - Client Profiles
    parameters:
      - $ref: './common.yml#/parameters/id'
    responses:
      '204':
        description: Client Profile was deleted successfully.
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '404':
        $ref: './common.yml#/responses/NotFoundError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
client-profiles-url:
  get:
    summary: Get connection URL for the Client Profile.
    description: Get connection URL for the Client Profile.
    tags:
      - Client Profiles
    parameters:
      - $ref: './common.yml#/parameters/id'
    responses:
      '200':
        description: Connection URL for the given Client Profile.
        content:
          application/json:
            schema:
              properties:
                url:
                  type: string
                  description: Connection URL for the Client Profile.
                  example: appgate://appgate.company.com/eyJjYUZpbmdlcnByaW50IjoiMmM4ZTBiNTM5YTM4NjRkYmVkYzhiOWRkMTcwYzM0NGFhMjZjZTVhNjA4MmY3YTI0YzRkZTU4ZGQ3NWRjNWZhMCIsImlkZW50aXR5UHJvdmlkZXJOYW1lIjoibG9jYWwifQ==
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '404':
        $ref: './common.yml#/responses/NotFoundError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'
client-profiles-barcode:
  get:
    summary: Get QR code for a Client Profile URL.
    description: Get QR code for Client Profile URL.
    tags:
      - Client Profiles
    parameters:
      - $ref: './common.yml#/parameters/id'
    responses:
      '200':
        description: QR code for the given Client Profile.
        content:
          application/json:
            schema:
              properties:
                barcode:
                  type: string
                  format: byte
                  description: The QR code image in PNG format, in base64 format.
      '401':
        $ref: './common.yml#/responses/TokenError'
      '403':
        $ref: './common.yml#/responses/PermissionError'
      '404':
        $ref: './common.yml#/responses/NotFoundError'
      '406':
        $ref: './common.yml#/responses/NotAcceptableError'
      '500':
        $ref: './common.yml#/responses/UnexpectedError'

requestBodies:
  ClientProfile:
    content:
      application/json:
        schema:
          $ref: '#/definitions/ClientProfileDiscriminator'
    description: Client Profile object.
    required: true

definitions:
  ClientProfileList:
    allOf:
      - $ref: './common.yml#/definitions/ResultList'
      - type: object
        description: Represents a list of Client Profiles.
        properties:
          data:
            type: array
            description: List of Client Profiles.
            items:
              $ref: '#/definitions/ClientProfileDiscriminator'
  ClientProfileDiscriminator:
    type: object
    discriminator:
      propertyName: type
      mapping:
        Profile: '#/definitions/ClientProfile'
        Group: '#/definitions/ClientProfileGroup'
  BaseClientProfile:
    allOf:
      - $ref: './common.yml#/definitions/BaseEntity'
      - type: object
        required:
          - name
        properties:
          name:
            type: string
            description: A name to identify the client profile. It will appear on the client UI.
            example: Company Employee
          type:
            type: string
            description: Type of the client profile.
            default: Profile
            enum:
              - Profile
              - Group
  ClientProfile:
    allOf:
      - $ref: '#/definitions/BaseClientProfile'
      - type: object
        description: Represents a Client Profile.
        required:
          - identityProviderName
        properties:
          spaKeyName:
            type: string
            deprecated: true
            description: >-
              SPA key name to be used in the profile.
              Same key names in different profiles will have the same SPA key.
              SPA key is used by the client to connect to the controllers.
              If left empty, the name will be generated by the controller using the profile name.
            example: test_key
          identityProviderName:
            type: string
            description: Name of the Identity Provider to be used to authenticate.
            example: local
          hostname:
            type: string
            description: >-
              Overrides the Profile Hostname in global settings for this specific profile.
              Generated URLs will use this hostname instead.
            example: "appgate.company.com"
          globalHostname:
            type: string
            readOnly: true
            description: >-
              The Global Profile Hostname as defined in global settings.
              Generated URLs will use this hostname.
            example: "appgate.company.com"
          exported:
            type: string
            format: date-time
            description: >-
              Exported time is the last time when the client profile is exported either using 
              the URL or Barcode.
            example: "2022-05-20T13:35:31.836392Z"
  ClientProfileGroup:
    allOf:
      - $ref: '#/definitions/BaseClientProfile'
      - type: object
        description: Represents a group of client profiles.
        properties:
          profileUrls:
            type: array
            description: List of Client Profile URLs in this group.
            items:
              $ref: '#/definitions/WeightedExternalProfile'
  WeightedExternalProfile:
    allOf:
    - $ref: '#/definitions/ExternalProfile'
    - type: object
      properties:
        weight:
          type: integer
          description: Load balancing weight of the profile in this group.
          default: 100
  ExternalProfile:
    type: object
    properties:
      id:
        type: string
        format: uuid
        description: Identifier to track the object on update since all the other fields are write-only. A random one will be assigned if left empty.
      url:
        type: string
        writeOnly: true
        description: Appgate URL exported from Client Profiles.
        example: appgate://appgate.company.com/eyJjYUZpbmdlcnByaW50IjoiMmM4ZTBiNTM5YTM4NjRkYmVkYzhiOWRkMTcwYzM0NGFhMjZjZTVhNjA4MmY3YTI0YzRkZTU4ZGQ3NWRjNWZhMCIsImlkZW50aXR5UHJvdmlkZXJOYW1lIjoibG9jYWwifQ==
      hostname:
        type: string
        readOnly: true
        description: Hostname parsed from the given URL.
        example: appgate.company.com
      profileName:
        type: string
        readOnly: true
        description: Profile name parsed from the given URL.
        example: Main Profile
